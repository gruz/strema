<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FORPOST Stream - –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 12px;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .cpu-mode-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 12px;
            margin-left: 8px;
        }

        .cpu-normal {
            background: #d1ecf1;
            color: #0c5460;
        }

        .cpu-high {
            background: #fff3cd;
            color: #856404;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group .help-text {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.show {
            display: block;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0f0f0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes blink-red {
            0%, 100% { 
                border-color: #ccc;
                box-shadow: none;
            }
            50% { 
                border-color: #dc3545;
                box-shadow: 0 0 10px rgba(220, 53, 69, 0.5);
            }
        }

        .update-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .update-overlay.show {
            display: flex;
        }

        .update-overlay .spinner {
            border-color: #f3f3f3;
            border-top-color: #667eea;
            width: 60px;
            height: 60px;
            border-width: 6px;
        }

        .update-overlay .message {
            color: white;
            font-size: 18px;
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="updateOverlay" class="update-overlay">
        <div class="spinner"></div>
        <div class="message" id="updateMessage">–û–Ω–æ–≤–ª–µ–Ω–Ω—è...</div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üé• FORPOST Stream</h1>
            <p>–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≤—ñ–¥–µ–æ–ø–æ—Ç–æ–∫—É <span style="color: #999; font-size: 12px;">v{{ version }}</span></p>
            <div>
                <span id="statusBadge"></span>
                <span id="operationBadge" class="status-badge status-pending" style="display:none;"></span>
                <span id="cpuModeBadge" class="cpu-mode-badge cpu-high">‚ö° –ü–µ—Ä–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è</span>
            </div>
        </div>

        <div id="alertBox" class="alert"></div>


        <div class="card" id="updateCard">
            <div class="section-title" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;" onclick="toggleUpdateSection()">
                <span>üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ <span style="font-size: 12px; color: #999;">(–≤–µ—Ä—Å—ñ—è: <span id="currentVersionBadge">...</span>)</span> <span id="newVersionBadge" style="display: none; background: #28a745; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-left: 8px;">–ù–û–í–ê –í–ï–†–°–Ü–Ø</span></span>
                <span id="updateToggleIcon" style="font-size: 20px;">‚ñº</span>
            </div>
            
            <div id="updateContent" style="display: none; margin-top: 12px;">
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div>
                            <strong>–ü–æ—Ç–æ—á–Ω–∞ –≤–µ—Ä—Å—ñ—è:</strong> <span id="currentVersion">...</span>
                        </div>
                        <div>
                            <label style="font-weight: normal; margin: 0;">
                                –ö–∞–Ω–∞–ª:
                                <select id="updateChannel" style="width: auto; padding: 4px 8px; margin-left: 8px;">
                                    <option value="stable">Stable</option>
                                    <option value="beta">Beta</option>
                                </select>
                            </label>
                        </div>
                    </div>
                    
                    <div id="updateAvailable" style="display: none; background: #d4edda; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                        <strong style="color: #155724;">‚ú® –î–æ—Å—Ç—É–ø–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: <span id="latestVersion"></span></strong>
                    </div>
                    
                    <div id="updatesList"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="section-title">–ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç—Ä—ñ–º—ñ–Ω–≥–æ–º</div>
            
            <div class="button-group">
                <button type="button" class="btn btn-primary" id="startBtn">
                    ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å—Ç—Ä—ñ–º
                </button>
                <button type="button" class="btn btn-secondary" id="stopBtn">
                    ‚èπÔ∏è –ó—É–ø–∏–Ω–∏—Ç–∏ —Å—Ç—Ä—ñ–º
                </button>
                <button type="button" class="btn btn-secondary" id="restartStreamBtn">
                    üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å—Ç—Ä—ñ–º
                </button>
            </div>

            <div class="form-group" style="margin-top: 20px;">
                <label>
                    <input type="checkbox" id="autostartCheckbox" style="width: auto; margin-right: 8px;">
                    –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Å—Ç—Ä—ñ–º—É –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å–∏—Å—Ç–µ–º–∏
                </label>
                <span class="help-text">–Ø–∫—â–æ —É–≤—ñ–º–∫–Ω–µ–Ω–æ, —Ç–æ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—è —É –í–µ–∂—É —Å—Ç–∞—Ä—Ç—É—î –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω—ñ –î–∑–∏–≥–∏. –Ü–Ω–∞–∫—à–µ —ó—ó —Ç—Ä–µ–±–∞ –≤—Ä—É—á–Ω—É –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —á–µ—Ä–µ–∑ —Ü–µ–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å.</span>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="autorestartCheckbox" style="width: auto; margin-right: 8px;">
                    –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó
                </label>
                <span class="help-text">–î–æ–∑–≤–æ–ª—è—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑–±–∏–≤–∞—Ç–∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—é —É –í–µ–∂—ñ –Ω–∞ –±–ª–æ–∫–∏</span>
            </div>

            <div class="form-group" id="autorestartIntervalGroup" style="display: none;">
                <label for="autorestartInterval">–ü–µ—Ä—ñ–æ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É (–≥–æ–¥–∏–Ω–∏)</label>
                <input type="number" id="autorestartInterval" min="1" max="24" value="2" style="width: 100px;">
            </div>
        </div>

        <div class="card">
            <div class="section-title">üîß –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</div>
            
            <div style="background: #d1ecf1; padding: 12px; border-radius: 8px; margin-bottom: 16px; border-left: 4px solid #17a2b8;">
                <strong style="color: #0c5460;">üîÑ Reset RP2040:</strong>
                <p style="margin: 8px 0 0 0; font-size: 13px; color: #0c5460;">
                    –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ "No serial port" –∞–±–æ –∑–∞–≤–∏—Å–∞–Ω–Ω—ñ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ —á–∞—Å—Ç–æ—Ç (–±–∞–≥–∞—Ç–æ "No data > 2s" —É –ª–æ–≥–∞—Ö). –í–∏–∫–æ–Ω—É—î –º'—è–∫–∏–π reset –±–µ–∑ –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ —Å–∏—Å—Ç–µ–º–∏.
                </p>
            </div>

            <div style="background: #fff3cd; padding: 12px; border-radius: 8px; margin-bottom: 16px; border-left: 4px solid #ffc107;">
                <strong style="color: #856404;">üîÑ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Dzyga:</strong>
                <p style="margin: 8px 0 0 0; font-size: 13px; color: #856404;">
                    –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –º–æ–¥—É–ª—å –ø–æ—à—É–∫—É —á–∞—Å—Ç–æ—Ç. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –∑ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º –¥–æ RP2040 –∞–±–æ –∑–∞–≤–∏—Å–∞–Ω–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∞.
                </p>
            </div>

            <div class="button-group">
                <button type="button" class="btn btn-secondary" id="resetRp2040Btn" style="background: #ffc107; color: #333;">
                    üîÑ Reset RP2040
                </button>
                <button type="button" class="btn btn-secondary" id="restartDzygaBtn" style="background: #17a2b8; color: white;">
                    üîÑ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Dzyga
                </button>
            </div>

            <div id="rp2040ResetStatus" style="display: none; margin-top: 12px; padding: 12px; border-radius: 8px; font-size: 13px;"></div>
        </div>

        <div class="card">
            <div class="section-title" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;" onclick="togglePowerSettings()">
                <span>‚ö° –ï–Ω–µ—Ä–≥–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è <span style="font-size: 12px; color: #999;">(–¥–ª—è –¥–æ–≤–≥–∏—Ö PoE –∫–∞–±–µ–ª—ñ–≤)</span></span>
                <span id="powerSettingsIcon" style="font-size: 20px;">‚ñº</span>
            </div>
            
            <div id="powerSettingsSection" style="display: none; margin-top: 12px;">
                <div style="background: #fff3cd; padding: 12px; border-radius: 8px; margin-bottom: 16px; border-left: 4px solid #ffc107;">
                    <strong style="color: #856404;">üí° –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:</strong>
                    <p style="margin: 8px 0 0 0; font-size: 13px; color: #856404;">
                        –ü—Ä–∏ –∂–∏–≤–ª–µ–Ω–Ω—ñ —á–µ—Ä–µ–∑ PoE –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—ñ 80-100–º –º–æ–∂–ª–∏–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏ –∑—ñ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—é —á–µ—Ä–µ–∑ –ø–∞–¥—ñ–Ω–Ω—è –Ω–∞–ø—Ä—É–≥–∏. 
                        –í–∏–º–∫–Ω–µ–Ω–Ω—è –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ –∑–º–µ–Ω—à—É—î —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –Ω–∞ 2-3W —ñ –ø—ñ–¥–≤–∏—â—É—î —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å.
                    </p>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="powerSaveWifi" style="width: auto; margin-right: 8px;">
                        –í–∏–º–∫–Ω—É—Ç–∏ WiFi
                    </label>
                    <span class="help-text">–ï–∫–æ–Ω–æ–º—ñ—è ~1W. –í–∏–º–∏–∫–∞–π—Ç–µ, —è–∫—â–æ WiFi –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è.</span>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="powerSaveBluetooth" style="width: auto; margin-right: 8px;">
                        –í–∏–º–∫–Ω—É—Ç–∏ Bluetooth
                    </label>
                    <span class="help-text">–ï–∫–æ–Ω–æ–º—ñ—è ~0.5W. –í–∏–º–∏–∫–∞–π—Ç–µ, —è–∫—â–æ Bluetooth –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è.</span>
                </div>


                <div class="form-group">
                    <label for="powerSaveEthSpeed">–®–≤–∏–¥–∫—ñ—Å—Ç—å Ethernet</label>
                    <span class="help-text">100Mbps —Å–ø–æ–∂–∏–≤–∞—î –º–µ–Ω—à–µ –µ–Ω–µ—Ä–≥—ñ—ó —ñ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—à–∏–π –Ω–∞ –¥–æ–≤–≥–∏—Ö –∫–∞–±–µ–ª—è—Ö. –í–∏–º–∫–Ω–µ–Ω–Ω—è auto-negotiation –∑–∞–ø–æ–±—ñ–≥–∞—î Link Down/Up —Ü–∏–∫–ª–∞–º.</span>
                    <select id="powerSaveEthSpeed">
                        <option value="auto">–ê–≤—Ç–æ (1000Mbps –∑ auto-negotiation)</option>
                        <option value="1000">1000Mbps –±–µ–∑ auto-negotiation</option>
                        <option value="100">100Mbps –±–µ–∑ auto-negotiation (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –¥–ª—è PoE 100–º)</option>
                    </select>
                </div>

                <div style="background: #d1ecf1; padding: 12px; border-radius: 8px; margin: 16px 0; border-left: 4px solid #17a2b8;">
                    <strong style="color: #0c5460;">üìä –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω:</strong>
                    <div style="margin-top: 8px; font-size: 13px; color: #0c5460;">
                        <div>WiFi: <span id="currentWifiState">...</span></div>
                        <div>Bluetooth: <span id="currentBluetoothState">...</span></div>
                        <div>Ethernet: <span id="currentEthState">...</span></div>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-primary" id="applyPowerBtn">
                        ‚ö° –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <form id="configForm">
                <div class="section-title">–û—Å–Ω–æ–≤–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</div>

                <div class="form-group">
                    <label for="RTMP_URL">RTMP URL</label>
                    <span class="help-text">–ü–æ–≤–Ω–∏–π URL –¥–ª—è —Å—Ç—Ä—ñ–º—É (–Ω–∞–ø—Ä. rtmps://server:port/app/key)</span>
                    <input type="text" id="RTMP_URL" name="RTMP_URL" required>
                </div>

                <div class="section-title">–û–≤–µ—Ä–ª–µ–π –Ω–∞ –≤—ñ–¥–µ–æ</div>

                <div class="form-group">
                    <label for="OVERLAY_ENABLED">–£–≤—ñ–º–∫–Ω—É—Ç–∏ –æ–≤–µ—Ä–ª–µ–π</label>
                    <span class="help-text" style="color: #d9534f; font-weight: 600;">‚ö†Ô∏è –£–í–ê–ì–ê: –û–≤–µ—Ä–ª–µ–π –∑–±—ñ–ª—å—à—É—î –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ CPU —ñ –≤–∏–º–∏–∫–∞—î –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Å—Ç—Ä—ñ–º—É (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø–µ—Ä–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è)</span>
                    <select id="OVERLAY_ENABLED" name="OVERLAY_ENABLED">
                        <option value="true" selected>–¢–∞–∫</option>
                        <option value="false">–ù—ñ</option>
                    </select>
                </div>

                <div id="overlayOptionsSection" style="display: block;">
                    <!-- Static Overlay -->
                    <div class="section-title" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; margin-top: 20px;" onclick="toggleStaticOverlay()">
                        <span>üìù –°—Ç–∞—Ç–∏—á–Ω–∏–π —Ç–µ–∫—Å—Ç</span>
                        <span id="staticOverlayIcon" style="font-size: 20px;">‚ñº</span>
                    </div>
                    
                    <div id="staticOverlaySection" style="display: none; margin: 12px 0; padding: 20px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px;">
                        <div class="form-group">
                            <label for="OVERLAY_TEXT">–¢–µ–∫—Å—Ç –æ–≤–µ—Ä–ª–µ—é</label>
                            <span class="help-text">–°—Ç–∞—Ç–∏—á–Ω–∏–π —Ç–µ–∫—Å—Ç, —è–∫–∏–π –∑–∞–≤–∂–¥–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –Ω–∞ –≤—ñ–¥–µ–æ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –Ω–æ–º–µ—Ä –ø—Ä–∏—Å—Ç—Ä–æ—é, —É–º–æ–≤–Ω–µ –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è</span>
                            <input type="text" id="OVERLAY_TEXT" name="OVERLAY_TEXT" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: [N] –¥–∑–∏–≥–∞">
                        </div>

                        <div class="form-group">
                            <label for="OVERLAY_POSITION">–ü–æ–∑–∏—Ü—ñ—è —Ç–µ–∫—Å—Ç—É</label>
                            <select id="OVERLAY_POSITION" name="OVERLAY_POSITION">
                                <option value="top-left">–ó–≤–µ—Ä—Ö—É –∑–ª—ñ–≤–∞</option>
                                <option value="top-right">–ó–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞</option>
                                <option value="bottom-left">–ó–Ω–∏–∑—É –∑–ª—ñ–≤–∞</option>
                                <option value="bottom-right">–ó–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞</option>
                            </select>
                        </div>

                        <div class="section-title" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; margin-top: 20px; font-size: 14px;" onclick="toggleStaticSettings()">
                            <span>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</span>
                            <span id="staticSettingsIcon" style="font-size: 16px;">‚ñº</span>
                        </div>
                        
                        <div id="staticSettings" style="display: none; margin: 12px 0; padding: 15px; background: #fff; border: 1px solid #dee2e6; border-radius: 8px;">
                            <div class="form-group">
                                <label for="OVERLAY_FONTSIZE_CUSTOM">–†–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É</label>
                                <input type="number" id="OVERLAY_FONTSIZE_CUSTOM" name="OVERLAY_FONTSIZE_CUSTOM" value="20" min="8" max="72">
                            </div>

                            <div class="form-group">
                                <label for="OVERLAY_TEXT_COLOR">–ö–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É</label>
                                <select id="OVERLAY_TEXT_COLOR" name="OVERLAY_TEXT_COLOR">
                                    <option value="white" selected>–ë—ñ–ª–∏–π</option>
                                    <option value="yellow">–ñ–æ–≤—Ç–∏–π</option>
                                    <option value="red">–ß–µ—Ä–≤–æ–Ω–∏–π</option>
                                    <option value="green">–ó–µ–ª–µ–Ω–∏–π</option>
                                    <option value="blue">–°–∏–Ω—ñ–π</option>
                                    <option value="orange">–ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π</option>
                                    <option value="cyan">–ë–ª–∞–∫–∏—Ç–Ω–∏–π</option>
                                    <option value="magenta">–ü—É—Ä–ø—É—Ä–Ω–∏–π</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="OVERLAY_TEXT_OPACITY_CUSTOM">–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å —Ç–µ–∫—Å—Ç—É (0.0 - 1.0)</label>
                                <input type="number" id="OVERLAY_TEXT_OPACITY_CUSTOM" name="OVERLAY_TEXT_OPACITY_CUSTOM" value="1.0" min="0" max="1" step="0.1">
                            </div>

                            <div class="form-group">
                                <label for="OVERLAY_BORDER_WIDTH">–¢–æ–≤—â–∏–Ω–∞ –æ–±–≤–æ–¥–∫–∏ (0 = —Ñ–æ–Ω)</label>
                                <span class="help-text">–û–±–≤–æ–¥–∫–∞ —Ä–æ–±–∏—Ç—å —Ç–µ–∫—Å—Ç —á–∏—Ç–∞–±–µ–ª—å–Ω–∏–º –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É —Ç–ª—ñ</span>
                                <input type="number" id="OVERLAY_BORDER_WIDTH" name="OVERLAY_BORDER_WIDTH" value="0" min="0" max="10">
                            </div>

                            <div id="staticBgGroup" style="display: block;">
                                <div class="form-group">
                                    <label for="OVERLAY_BG_COLOR">–ö–æ–ª—ñ—Ä —Ñ–æ–Ω—É</label>
                                    <select id="OVERLAY_BG_COLOR" name="OVERLAY_BG_COLOR">
                                        <option value="black" selected>–ß–æ—Ä–Ω–∏–π</option>
                                        <option value="white">–ë—ñ–ª–∏–π</option>
                                        <option value="red">–ß–µ—Ä–≤–æ–Ω–∏–π</option>
                                        <option value="green">–ó–µ–ª–µ–Ω–∏–π</option>
                                        <option value="blue">–°–∏–Ω—ñ–π</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="OVERLAY_BG_OPACITY_CUSTOM">–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å —Ñ–æ–Ω—É (0.0 - 1.0)</label>
                                    <input type="number" id="OVERLAY_BG_OPACITY_CUSTOM" name="OVERLAY_BG_OPACITY_CUSTOM" value="0.5" min="0" max="1" step="0.1">
                                </div>
                            </div>

                            <div id="staticBorderGroup" style="display: none;">
                                <div class="form-group">
                                    <label for="OVERLAY_BORDER_COLOR">–ö–æ–ª—ñ—Ä –æ–±–≤–æ–¥–∫–∏</label>
                                    <select id="OVERLAY_BORDER_COLOR" name="OVERLAY_BORDER_COLOR">
                                        <option value="black" selected>–ß–æ—Ä–Ω–∏–π</option>
                                        <option value="white">–ë—ñ–ª–∏–π</option>
                                        <option value="red">–ß–µ—Ä–≤–æ–Ω–∏–π</option>
                                        <option value="green">–ó–µ–ª–µ–Ω–∏–π</option>
                                        <option value="blue">–°–∏–Ω—ñ–π</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Frequency Display -->
                    <div class="section-title" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; margin-top: 20px;" onclick="toggleFrequencyOverlay()">
                        <span>üì° –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —á–∞—Å—Ç–æ—Ç–∏</span>
                        <span id="frequencyOverlayIcon" style="font-size: 20px;">‚ñº</span>
                    </div>
                    
                    <div id="frequencyOverlaySection" style="display: none; margin: 12px 0; padding: 20px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px;">
                        <div class="form-group">
                            <label for="SHOW_FREQUENCY">–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ —á–∞—Å—Ç–æ—Ç—É</label>
                            <select id="SHOW_FREQUENCY" name="SHOW_FREQUENCY">
                                <option value="true">–¢–∞–∫</option>
                                <option value="false">–ù—ñ</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="FREQUENCY_POSITION">–ü–æ–∑–∏—Ü—ñ—è —á–∞—Å—Ç–æ—Ç–∏</label>
                            <select id="FREQUENCY_POSITION" name="FREQUENCY_POSITION">
                                <option value="top-left">–ó–≤–µ—Ä—Ö—É –∑–ª—ñ–≤–∞</option>
                                <option value="top-right">–ó–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞</option>
                                <option value="bottom-left">–ó–Ω–∏–∑—É –∑–ª—ñ–≤–∞</option>
                                <option value="bottom-right">–ó–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞</option>
                            </select>
                        </div>

                        <div class="section-title" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; margin-top: 20px; font-size: 14px;" onclick="toggleFrequencySettings()">
                            <span>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</span>
                            <span id="frequencySettingsIcon" style="font-size: 16px;">‚ñº</span>
                        </div>
                        
                        <div id="frequencySettings" style="display: none; margin: 12px 0; padding: 15px; background: #fff; border: 1px solid #dee2e6; border-radius: 8px;">
                            <div class="form-group">
                                <label for="FREQUENCY_FONTSIZE">–†–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É</label>
                                <input type="number" id="FREQUENCY_FONTSIZE" name="FREQUENCY_FONTSIZE" value="20" min="8" max="72">
                            </div>

                            <div class="form-group">
                                <label for="FREQUENCY_TEXT_COLOR">–ö–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É</label>
                                <select id="FREQUENCY_TEXT_COLOR" name="FREQUENCY_TEXT_COLOR">
                                    <option value="white">–ë—ñ–ª–∏–π</option>
                                    <option value="yellow" selected>–ñ–æ–≤—Ç–∏–π</option>
                                    <option value="red">–ß–µ—Ä–≤–æ–Ω–∏–π</option>
                                    <option value="green">–ó–µ–ª–µ–Ω–∏–π</option>
                                    <option value="blue">–°–∏–Ω—ñ–π</option>
                                    <option value="orange">–ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π</option>
                                    <option value="cyan">–ë–ª–∞–∫–∏—Ç–Ω–∏–π</option>
                                    <option value="magenta">–ü—É—Ä–ø—É—Ä–Ω–∏–π</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="FREQUENCY_TEXT_OPACITY">–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å —Ç–µ–∫—Å—Ç—É (0.0 - 1.0)</label>
                                <input type="number" id="FREQUENCY_TEXT_OPACITY" name="FREQUENCY_TEXT_OPACITY" value="1.0" min="0" max="1" step="0.1">
                            </div>

                            <div class="form-group">
                                <label for="FREQUENCY_BORDER_WIDTH">–¢–æ–≤—â–∏–Ω–∞ –æ–±–≤–æ–¥–∫–∏ (0 = —Ñ–æ–Ω)</label>
                                <span class="help-text">–û–±–≤–æ–¥–∫–∞ —Ä–æ–±–∏—Ç—å —Ç–µ–∫—Å—Ç —á–∏—Ç–∞–±–µ–ª—å–Ω–∏–º –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É —Ç–ª—ñ</span>
                                <input type="number" id="FREQUENCY_BORDER_WIDTH" name="FREQUENCY_BORDER_WIDTH" value="0" min="0" max="10">
                            </div>

                            <div id="frequencyBgGroup" style="display: block;">
                                <div class="form-group">
                                    <label for="FREQUENCY_BG_COLOR">–ö–æ–ª—ñ—Ä —Ñ–æ–Ω—É</label>
                                    <select id="FREQUENCY_BG_COLOR" name="FREQUENCY_BG_COLOR">
                                        <option value="black" selected>–ß–æ—Ä–Ω–∏–π</option>
                                        <option value="white">–ë—ñ–ª–∏–π</option>
                                        <option value="red">–ß–µ—Ä–≤–æ–Ω–∏–π</option>
                                        <option value="green">–ó–µ–ª–µ–Ω–∏–π</option>
                                        <option value="blue">–°–∏–Ω—ñ–π</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="FREQUENCY_BG_OPACITY">–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å —Ñ–æ–Ω—É (0.0 - 1.0)</label>
                                    <input type="number" id="FREQUENCY_BG_OPACITY" name="FREQUENCY_BG_OPACITY" value="0.5" min="0" max="1" step="0.1">
                                </div>
                            </div>

                            <div id="frequencyBorderGroup" style="display: none;">
                                <div class="form-group">
                                    <label for="FREQUENCY_BORDER_COLOR">–ö–æ–ª—ñ—Ä –æ–±–≤–æ–¥–∫–∏</label>
                                    <select id="FREQUENCY_BORDER_COLOR" name="FREQUENCY_BORDER_COLOR">
                                        <option value="black" selected>–ß–æ—Ä–Ω–∏–π</option>
                                        <option value="white">–ë—ñ–ª–∏–π</option>
                                        <option value="red">–ß–µ—Ä–≤–æ–Ω–∏–π</option>
                                        <option value="green">–ó–µ–ª–µ–Ω–∏–π</option>
                                        <option value="blue">–°–∏–Ω—ñ–π</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dynamic Overlay -->
                    <div class="section-title" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; margin-top: 20px;" onclick="toggleDynamicOverlay()">
                        <span>üî§ –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –æ–≤–µ—Ä–ª–µ–π</span>
                        <span id="dynamicOverlayIcon" style="font-size: 20px;">‚ñº</span>
                    </div>
                    
                    <div id="dynamicOverlaySection" style="display: none; margin: 12px 0; padding: 20px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px;">
                        <div class="form-group">
                                <label for="dynamicOverlayText">–¢–µ–∫—Å—Ç –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–∞ –≤—ñ–¥–µ–æ</label>
                                <span class="help-text" style="display: block; margin-bottom: 8px;">
                                    <strong>–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:</strong> –í–∏–≤–µ–¥–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –æ–±'—î–∫—Ç –Ω–∞ –≤—ñ–¥–µ–æ (–Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç, –æ—Ä—ñ—î–Ω—Ç–∏—Ä–∏, –Ω–∞–ø—Ä—è–º —Ä—É—Ö—É, –∑–º—ñ–Ω–∏ –ø–æ–∑–∏—Ü—ñ—ó). 
                                    –ù–∞–ø—Ä–∏–∫–ª–∞–¥: "–î—Ä–æ–Ω –Ω–∞–¥ —Å.–°–º–µ—Ä—Ç—å–º–æ—Å–∫–∞–ª—å—Å—å–∫–µ, —Ä—É—Ö –Ω–∞ –ø—ñ–≤–Ω—ñ—á". 
                                    –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥—ñ –Ω–∞ —ñ–Ω—à—É —á–∞—Å—Ç–æ—Ç—É —Ç–µ–∫—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—á–∏—â–∞—î—Ç—å—Å—è, —â–æ–± –Ω–µ –≤–≤–æ–¥–∏—Ç–∏ –≤ –æ–º–∞–Ω—É.
                                </span>
                                <span class="help-text">üí° <strong>–ö–µ—Ä—É–≤–∞–Ω–Ω—è:</strong> Enter ‚Äî –∑–±–µ—Ä–µ–≥—Ç–∏ —Ç–µ–∫—Å—Ç –Ω–∞ –≤—ñ–¥–µ–æ ‚Ä¢ Escape –∞–±–æ ‚úï ‚Äî –æ—á–∏—Å—Ç–∏—Ç–∏ ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–Ω–∏–∫–∞—î –ø—Ä–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—ñ</span>
                                <div style="position: relative;">
                                    <input type="text" id="dynamicOverlayText" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å Enter..." style="padding-right: 35px;">
                                    <button type="button" id="clearDynamicText" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #999; font-size: 18px; cursor: pointer; padding: 5px 10px; display: none;" title="–û—á–∏—Å—Ç–∏—Ç–∏ —Ç–µ–∫—Å—Ç">‚úï</button>
                                </div>
                            </div>
                            <div style="margin-top: 8px; padding: 8px 12px; border-radius: 6px; font-size: 13px; display: flex; align-items: center; gap: 8px;" id="scanningStatus">
                                <span id="scanningIndicator" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #28a745;"></span>
                                <span id="scanningText" style="font-weight: 600; color: #28a745;">–ß–∞—Å—Ç–æ—Ç–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞</span>
                            </div>
                            <div style="margin-top: 12px; padding: 12px; background: #f0f0f0; border-radius: 8px; font-size: 13px; color: #666;">
                                <strong>–ü–æ—Ç–æ—á–Ω–∏–π —Ç–µ–∫—Å—Ç –Ω–∞ –≤—ñ–¥–µ–æ:</strong> <span id="currentDynamicText" style="color: #333; font-weight: 600;">‚Äî</span>
                            </div>

                            <!-- Dynamic Overlay Settings -->
                            <div class="section-title" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; margin-top: 20px; font-size: 14px;" onclick="toggleDynamicOverlaySettings()">
                                <span>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</span>
                                <span id="dynamicOverlaySettingsIcon" style="font-size: 16px;">‚ñº</span>
                            </div>
                            
                            <div id="dynamicOverlaySettings" style="display: none; margin: 12px 0; padding: 15px; background: #fff; border: 1px solid #dee2e6; border-radius: 8px;">
                                <div class="form-group">
                                    <label for="DYNAMIC_OVERLAY_POSITION">–ü–æ–∑–∏—Ü—ñ—è</label>
                                    <select id="DYNAMIC_OVERLAY_POSITION" name="DYNAMIC_OVERLAY_POSITION">
                                        <option value="top-left">–ó–≤–µ—Ä—Ö—É –∑–ª—ñ–≤–∞</option>
                                        <option value="top-right">–ó–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞</option>
                                        <option value="bottom-left" selected>–ó–Ω–∏–∑—É –∑–ª—ñ–≤–∞</option>
                                        <option value="bottom-right">–ó–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="DYNAMIC_OVERLAY_FONTSIZE">–†–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É</label>
                                    <input type="number" id="DYNAMIC_OVERLAY_FONTSIZE" name="DYNAMIC_OVERLAY_FONTSIZE" value="20" min="8" max="72">
                                </div>

                                <div class="form-group">
                                    <label for="DYNAMIC_OVERLAY_TEXT_COLOR">–ö–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É</label>
                                    <select id="DYNAMIC_OVERLAY_TEXT_COLOR" name="DYNAMIC_OVERLAY_TEXT_COLOR">
                                        <option value="white">–ë—ñ–ª–∏–π</option>
                                        <option value="yellow">–ñ–æ–≤—Ç–∏–π</option>
                                        <option value="red">–ß–µ—Ä–≤–æ–Ω–∏–π</option>
                                        <option value="green">–ó–µ–ª–µ–Ω–∏–π</option>
                                        <option value="blue">–°–∏–Ω—ñ–π</option>
                                        <option value="orange">–ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π</option>
                                        <option value="cyan">–ë–ª–∞–∫–∏—Ç–Ω–∏–π</option>
                                        <option value="magenta">–ü—É—Ä–ø—É—Ä–Ω–∏–π</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="DYNAMIC_OVERLAY_TEXT_OPACITY">–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å —Ç–µ–∫—Å—Ç—É (0.0 - 1.0)</label>
                                    <input type="number" id="DYNAMIC_OVERLAY_TEXT_OPACITY" name="DYNAMIC_OVERLAY_TEXT_OPACITY" value="1.0" min="0" max="1" step="0.1">
                                </div>

                                <div class="form-group">
                                    <label for="DYNAMIC_OVERLAY_BORDER_WIDTH">–¢–æ–≤—â–∏–Ω–∞ –æ–±–≤–æ–¥–∫–∏ (0 = —Ñ–æ–Ω)</label>
                                    <span class="help-text">–û–±–≤–æ–¥–∫–∞ —Ä–æ–±–∏—Ç—å —Ç–µ–∫—Å—Ç —á–∏—Ç–∞–±–µ–ª—å–Ω–∏–º –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É —Ç–ª—ñ</span>
                                    <input type="number" id="DYNAMIC_OVERLAY_BORDER_WIDTH" name="DYNAMIC_OVERLAY_BORDER_WIDTH" value="0" min="0" max="10">
                                </div>

                                <div id="dynamicBgGroup" style="display: block;">
                                    <div class="form-group">
                                        <label for="DYNAMIC_OVERLAY_BG_COLOR">–ö–æ–ª—ñ—Ä —Ñ–æ–Ω—É</label>
                                        <select id="DYNAMIC_OVERLAY_BG_COLOR" name="DYNAMIC_OVERLAY_BG_COLOR">
                                            <option value="black">–ß–æ—Ä–Ω–∏–π</option>
                                            <option value="white">–ë—ñ–ª–∏–π</option>
                                            <option value="red">–ß–µ—Ä–≤–æ–Ω–∏–π</option>
                                            <option value="green">–ó–µ–ª–µ–Ω–∏–π</option>
                                            <option value="blue">–°–∏–Ω—ñ–π</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="DYNAMIC_OVERLAY_BG_OPACITY">–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å —Ñ–æ–Ω—É (0.0 - 1.0)</label>
                                        <input type="number" id="DYNAMIC_OVERLAY_BG_OPACITY" name="DYNAMIC_OVERLAY_BG_OPACITY" value="0.5" min="0" max="1" step="0.1">
                                    </div>
                                </div>

                                <div id="dynamicBorderGroup" style="display: none;">
                                    <div class="form-group">
                                        <label for="DYNAMIC_OVERLAY_BORDER_COLOR">–ö–æ–ª—ñ—Ä –æ–±–≤–æ–¥–∫–∏</label>
                                        <select id="DYNAMIC_OVERLAY_BORDER_COLOR" name="DYNAMIC_OVERLAY_BORDER_COLOR">
                                            <option value="black">–ß–æ—Ä–Ω–∏–π</option>
                                            <option value="white">–ë—ñ–ª–∏–π</option>
                                            <option value="red">–ß–µ—Ä–≤–æ–Ω–∏–π</option>
                                            <option value="green">–ó–µ–ª–µ–Ω–∏–π</option>
                                            <option value="blue">–°–∏–Ω—ñ–π</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                    </div>
                </div>

                <div class="section-title">–†–µ–∂–∏–º —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó</div>

                <div class="form-group">
                    <label for="STREAM_MODE">–†–µ–∂–∏–º –ø—Ä–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—ñ</label>
                    <span class="help-text">–í–∏–∑–Ω–∞—á–∞—î –ø–æ–≤–µ–¥—ñ–Ω–∫—É —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó –∫–æ–ª–∏ DZYGA —Å–∫–∞–Ω—É—î —á–∞—Å—Ç–æ—Ç–∏</span>
                    <select id="STREAM_MODE" name="STREAM_MODE">
                        <option value="always">–ó–∞–≤–∂–¥–∏ —Ç—Ä–∞–Ω—Å–ª—é–≤–∞—Ç–∏ (—ñ–≥–Ω–æ—Ä—É–≤–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è)</option>
                        <option value="on-lock">–¢—Ä–∞–Ω—Å–ª—é–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –∑—É–ø–∏–Ω—Ü—ñ (–ø–∞—É–∑–∞ –ø—ñ–¥ —á–∞—Å —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è)</option>
                        <option value="overlay">–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä "–°–ö–ê–ù–£–í–ê–ù–ù–Ø..." –Ω–∞ –µ–∫—Ä–∞–Ω—ñ</option>
                    </select>
                </div>

                <div class="section-title">–Ø–∫—ñ—Å—Ç—å –≤—ñ–¥–µ–æ</div>

                <div class="form-group">
                    <label for="VIDEO_CRF">CRF (—è–∫—ñ—Å—Ç—å –≤—ñ–¥–µ–æ)</label>
                    <span class="help-text">28-32 = –Ω–∏–∑—å–∫–∏–π CPU, 23-27 = –∫—Ä–∞—â–∞ —è–∫—ñ—Å—Ç—å</span>
                    <input type="number" id="VIDEO_CRF" name="VIDEO_CRF" value="28" min="18" max="35">
                </div>

                <div class="form-group">
                    <label for="VIDEO_FPS">–ö–∞–¥—Ä—ñ–≤ –Ω–∞ —Å–µ–∫—É–Ω–¥—É (FPS)</label>
                    <span class="help-text">15 = –µ–∫–æ–Ω–æ–º—ñ—è —Ç—Ä–∞—Ñ—ñ–∫—É, 25 = –ø–ª–∞–≤–Ω–µ –≤—ñ–¥–µ–æ</span>
                    <span class="help-text" style="color: #666; font-style: italic;">‚ö†Ô∏è –ü—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–æ–¥—É–≤–∞–Ω–Ω—ñ (–∫–æ–ª–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ –æ–≤–µ—Ä–ª–µ–π –∞–±–æ —á–∞—Å—Ç–æ—Ç—É)</span>
                    <input type="number" id="VIDEO_FPS" name="VIDEO_FPS" value="15" min="10" max="30">
                </div>

                <details style="margin-top: 16px;">
                    <summary style="cursor: pointer; font-weight: 600; color: #333;">–†–æ–∑—à–∏—Ä–µ–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</summary>

                    <div class="form-group" style="margin-top: 16px;">
                        <label for="USE_UDP_PROXY">UDP Proxy —Ä–µ–∂–∏–º</label>
                        <span class="help-text">–Ü–∑–æ–ª—é—î ffmpeg –≤—ñ–¥ RTSP –¥–∂–µ—Ä–µ–ª–∞, –∑–∞–ø–æ–±—ñ–≥–∞—î –±–ª–æ–∫—É–≤–∞–Ω–Ω—é —ñ–Ω—à–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤ (GStreamer/VLC)</span>
                        <span class="help-text" style="color: #28a745; font-weight: 600;">‚úì –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ: —É–≤—ñ–º–∫–Ω–µ–Ω–æ</span>
                        <select id="USE_UDP_PROXY" name="USE_UDP_PROXY">
                            <option value="true">–£–≤—ñ–º–∫–Ω–µ–Ω–æ</option>
                            <option value="false">–í–∏–º–∫–Ω–µ–Ω–æ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="FORPOST_IP">IP –∞–¥—Ä–µ—Å–∞ FORPOST</label>
                        <span class="help-text">–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ "auto" –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è</span>
                        <input type="text" id="FORPOST_IP" name="FORPOST_IP" value="auto">
                    </div>

                    <div class="form-group">
                        <label for="RTSP_PORT">RTSP –ø–æ—Ä—Ç</label>
                        <input type="number" id="RTSP_PORT" name="RTSP_PORT" value="8554">
                    </div>

                    <div class="form-group">
                        <label for="VIDEO_DEVICE">–í—ñ–¥–µ–æ –ø—Ä–∏—Å—Ç—Ä—ñ–π</label>
                        <input type="text" id="VIDEO_DEVICE" name="VIDEO_DEVICE" value="devvideo0">
                    </div>
                </details>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary" id="saveBtn">
                        üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function showAlert(message, type) {
            const alertBox = document.getElementById('alertBox');
            alertBox.textContent = message;
            alertBox.className = `alert alert-${type} show`;
            setTimeout(() => {
                alertBox.classList.remove('show');
            }, 5000);
        }

        function updateStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    const badge = document.getElementById('statusBadge');
                    if (data.active) {
                        badge.className = 'status-badge status-active';
                        badge.textContent = '‚óè –ê–∫—Ç–∏–≤–Ω–∏–π';
                    } else {
                        badge.className = 'status-badge status-inactive';
                        badge.textContent = '‚óè –ù–µ–∞–∫—Ç–∏–≤–Ω–∏–π';
                    }
                    
                    // Update autostart checkbox
                    const checkbox = document.getElementById('autostartCheckbox');
                    if (checkbox) {
                        checkbox.checked = data.autostart || false;
                    }
                })
                .catch(err => console.error('Failed to fetch status:', err));
        }

        function setOperationBadge(text) {
            const b = document.getElementById('operationBadge');
            if (!b) return;
            b.style.display = 'inline-block';
            b.textContent = text;
        }

        function clearOperationBadge() {
            const b = document.getElementById('operationBadge');
            if (!b) return;
            b.style.display = 'none';
            b.textContent = '';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function waitForDesiredActiveState(desiredActive, timeoutMs) {
            const startTs = Date.now();
            return new Promise((resolve, reject) => {
                const tick = () => {
                    fetch('/api/status')
                        .then(r => r.json())
                        .then(s => {
                            if ((s.active || false) === desiredActive) {
                                resolve(s);
                                return;
                            }
                            if (Date.now() - startTs >= timeoutMs) {
                                reject(new Error('TIMEOUT'));
                                return;
                            }
                            setTimeout(tick, 1000);
                        })
                        .catch(() => {
                            if (Date.now() - startTs >= timeoutMs) {
                                reject(new Error('TIMEOUT'));
                                return;
                            }
                            setTimeout(tick, 1000);
                        });
                };
                tick();
            });
        }

        function waitForRestart(timeoutMs) {
            const startTs = Date.now();
            let sawNonActive = false;
            return new Promise((resolve, reject) => {
                const tick = () => {
                    fetch('/api/status')
                        .then(r => r.json())
                        .then(s => {
                            const status = (s.status || '').trim();
                            if (status && status !== 'active') {
                                sawNonActive = true;
                            }
                            if (sawNonActive && status === 'active') {
                                resolve(s);
                                return;
                            }
                            if (Date.now() - startTs >= timeoutMs) {
                                reject(new Error('TIMEOUT'));
                                return;
                            }
                            setTimeout(tick, 1000);
                        })
                        .catch(() => {
                            if (Date.now() - startTs >= timeoutMs) {
                                reject(new Error('TIMEOUT'));
                                return;
                            }
                            setTimeout(tick, 1000);
                        });
                };
                tick();
            });
        }

        function updateCpuModeBadge(config) {
            const badge = document.getElementById('cpuModeBadge');
            const overlayEnabled = config.OVERLAY_ENABLED === 'true';
            
            if (overlayEnabled) {
                badge.className = 'cpu-mode-badge cpu-high';
                badge.textContent = '‚ö° –ü–µ—Ä–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è';
            } else {
                badge.className = 'cpu-mode-badge cpu-low';
                badge.textContent = '‚ú® –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è';
            }
        }

        function loadConfig() {
            fetch('/api/config')
                .then(response => response.json())
                .then(data => {
                    const config = data.config;
                    for (const [key, value] of Object.entries(config)) {
                        const input = document.getElementById(key);
                        if (input) {
                            input.value = value;
                        }
                    }
                    updateCpuModeBadge(config);
                    updateOverlayUI(config);
                })
                .catch(err => {
                    showAlert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó: ' + err.message, 'error');
                });
        }

        function updateOverlayUI(config) {
            // Show/hide overlay options section based on OVERLAY_ENABLED
            const overlayEnabled = config.OVERLAY_ENABLED === 'true';
            const overlayOptionsSection = document.getElementById('overlayOptionsSection');
            if (overlayOptionsSection) {
                overlayOptionsSection.style.display = overlayEnabled ? 'block' : 'none';
            }
            
            const borderWidth = parseInt(config.DYNAMIC_OVERLAY_BORDER_WIDTH);
            const bgGroup = document.getElementById('dynamicBgGroup');
            const borderGroup = document.getElementById('dynamicBorderGroup');
            if (bgGroup && borderGroup) {
                if (borderWidth > 0) {
                    bgGroup.style.display = 'none';
                    borderGroup.style.display = 'block';
                } else {
                    bgGroup.style.display = 'block';
                    borderGroup.style.display = 'none';
                }
            }
        }

        let lastScanningState = 'stable';
        let isTextSaved = true;  // Track if current text in input is saved to server
        let lastSavedText = '';  // Track what was last saved
        
        function loadDynamicOverlayText() {
            fetch('/api/dynamic-overlay')
                .then(response => response.json())
                .then(data => {
                    const currentText = document.getElementById('currentDynamicText');
                    const textInput = document.getElementById('dynamicOverlayText');
                    const clearButton = document.getElementById('clearDynamicText');
                    const scanningIndicator = document.getElementById('scanningIndicator');
                    const scanningText = document.getElementById('scanningText');
                    
                    // Always update display text with server value
                    if (currentText) {
                        currentText.textContent = data.text || '‚Äî';
                    }
                    
                    // Update scanning status indicator
                    const isScanning = data.scanning === 'scanning';
                    if (scanningIndicator && scanningText) {
                        if (isScanning) {
                            scanningIndicator.style.background = '#ffc107';
                            scanningText.style.color = '#ffc107';
                            scanningText.textContent = 'üîç –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è...';
                        } else {
                            scanningIndicator.style.background = '#28a745';
                            scanningText.style.color = '#28a745';
                            scanningText.textContent = '‚úì –ß–∞—Å—Ç–æ—Ç–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞';
                        }
                    }
                    
                    // Clear input only when:
                    // 1. Transitioning from stable to scanning
                    // 2. AND text was previously saved (not being edited)
                    if (lastScanningState === 'stable' && isScanning && isTextSaved) {
                        if (textInput) {
                            textInput.value = '';
                            lastSavedText = '';
                        }
                        if (clearButton) {
                            clearButton.style.display = 'none';
                        }
                    }
                    
                    lastScanningState = data.scanning || 'stable';
                    
                    // Update clear button visibility
                    if (clearButton && textInput) {
                        clearButton.style.display = textInput.value ? 'block' : 'none';
                    }
                })
                .catch(err => console.error('Failed to load dynamic overlay text:', err));
        }

        function saveDynamicOverlayText(text) {
            const isScanning = lastScanningState === 'scanning';
            // If scanning, show visual feedback and don't save
            if (isScanning) {
                const textInput = document.getElementById('dynamicOverlayText');
                if (textInput) {
                    // Blink effect
                    textInput.style.animation = 'none';
                    setTimeout(() => {
                        textInput.style.animation = 'blink-red 0.5s';
                    }, 10);
                }
                return;
            }
            
            fetch('/api/dynamic-overlay', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text: text })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Dynamic overlay text updated');
                    isTextSaved = true;
                    lastSavedText = text;
                    // Reload to show current text
                    loadDynamicOverlayText();
                }
            })
            .catch(err => console.error('Failed to save dynamic overlay text:', err));
        }

        document.getElementById('configForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const config = {};
            for (const [key, value] of formData.entries()) {
                config[key] = value;
            }

            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = '‚è≥ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...';

            fetch('/api/status')
            .then(r => r.json())
            .then(statusBefore => {
                const wasActive = statusBefore.active || false;

                return fetch('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(config)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showAlert('‚úÖ ' + data.message, 'success');
                        loadConfig();

                        if (wasActive) {
                            setOperationBadge('‚è≥ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫‚Ä¶');
                            const minVisibleMs = 1500;
                            const startedAt = Date.now();
                            return waitForRestart(25000)
                                .catch(() => null)
                                .then(() => updateStatus())
                                .finally(() => {
                                    const elapsed = Date.now() - startedAt;
                                    const remaining = Math.max(0, minVisibleMs - elapsed);
                                    setTimeout(() => {
                                        clearOperationBadge();
                                    }, remaining);
                                });
                        }
                    } else {
                        showAlert('‚ùå ' + data.error, 'error');
                    }
                });
            })
            .catch(err => {
                showAlert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message, 'error');
            })
            .finally(() => {
                saveBtn.disabled = false;
                saveBtn.textContent = 'üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é';
            });
        });

        // Start stream button
        document.getElementById('startBtn').addEventListener('click', function() {
            const btn = this;
            btn.disabled = true;
            const originalText = btn.textContent;
            btn.textContent = '‚è≥ –ó–∞–ø—É—Å–∫...';
            setOperationBadge('‚è≥ –ó–∞–ø—É—Å–∫‚Ä¶');

            fetch('/api/stream/start', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('‚úÖ ' + data.message, 'success');
                    return waitForDesiredActiveState(true, 20000)
                        .then(() => {
                            clearOperationBadge();
                            updateStatus();
                        })
                        .catch(() => {
                            clearOperationBadge();
                            updateStatus();
                        });
                } else {
                    showAlert('‚ùå ' + data.error, 'error');
                    clearOperationBadge();
                }
            })
            .catch(err => {
                showAlert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message, 'error');
                clearOperationBadge();
            })
            .finally(() => {
                btn.disabled = false;
                btn.textContent = originalText;
            });
        });

        // Stop stream button
        document.getElementById('stopBtn').addEventListener('click', function() {
            if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –∑—É–ø–∏–Ω–∏—Ç–∏ —Å—Ç—Ä—ñ–º?')) {
                return;
            }

            const btn = this;
            btn.disabled = true;
            const originalText = btn.textContent;
            btn.textContent = '‚è≥ –ó—É–ø–∏–Ω–∫–∞...';
            setOperationBadge('‚è≥ –ó—É–ø–∏–Ω–∫–∞‚Ä¶');

            fetch('/api/stream/stop', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('‚úÖ ' + data.message, 'success');
                    return waitForDesiredActiveState(false, 20000)
                        .then(() => {
                            clearOperationBadge();
                            updateStatus();
                        })
                        .catch(() => {
                            clearOperationBadge();
                            updateStatus();
                        });
                } else {
                    showAlert('‚ùå ' + data.error, 'error');
                    clearOperationBadge();
                }
            })
            .catch(err => {
                showAlert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message, 'error');
                clearOperationBadge();
            })
            .finally(() => {
                btn.disabled = false;
                btn.textContent = originalText;
            });
        });

        // Restart stream button
        document.getElementById('restartStreamBtn').addEventListener('click', function() {
            if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å—Ç—Ä—ñ–º?')) {
                return;
            }

            const btn = this;
            btn.disabled = true;
            const originalText = btn.textContent;
            btn.textContent = '‚è≥ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫...';
            setOperationBadge('‚è≥ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫‚Ä¶');


            fetch('/api/stream/restart', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('‚úÖ ' + data.message, 'success');
                    return waitForDesiredActiveState(true, 25000)
                        .then(() => {
                            clearOperationBadge();
                            updateStatus();
                        })
                        .catch(() => {
                            clearOperationBadge();
                            updateStatus();
                        });
                } else {
                    showAlert('‚ùå ' + data.error, 'error');
                    clearOperationBadge();
                }
            })
            .catch(err => {
                showAlert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message, 'error');
                clearOperationBadge();
            })
            .finally(() => {
                btn.disabled = false;
                btn.textContent = originalText;
            });
        });

        // Reset RP2040 button
        document.getElementById('resetRp2040Btn').addEventListener('click', function() {
            if (!confirm('–í–∏–∫–æ–Ω–∞—Ç–∏ –º\'—è–∫–∏–π reset RP2040? –¶–µ –¥–æ–ø–æ–º–æ–∂–µ –ø—Ä–∏ –∑–∞–≤–∏—Å–∞–Ω–Ω—ñ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ —á–∞—Å—Ç–æ—Ç.')) {
                return;
            }

            const btn = this;
            const statusDiv = document.getElementById('rp2040ResetStatus');
            btn.disabled = true;
            const originalText = btn.textContent;
            btn.textContent = '‚è≥ –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è reset...';
            
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#fff3cd';
            statusDiv.style.color = '#856404';
            statusDiv.textContent = '‚è≥ –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –º\'—è–∫–∏–π reset RP2040...';

            fetch('/api/reset-rp2040', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    statusDiv.style.background = '#d4edda';
                    statusDiv.style.color = '#155724';
                    statusDiv.textContent = '‚úÖ ' + data.message;
                    showAlert('‚úÖ ' + data.message, 'success');
                } else {
                    statusDiv.style.background = '#f8d7da';
                    statusDiv.style.color = '#721c24';
                    statusDiv.textContent = '‚ùå ' + data.error;
                    showAlert('‚ùå ' + data.error, 'error');
                }
                
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 10000);
            })
            .catch(err => {
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message;
                showAlert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message, 'error');
                
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 10000);
            })
            .finally(() => {
                btn.disabled = false;
                btn.textContent = originalText;
            });
        });

        // Restart Dzyga button
        document.getElementById('restartDzygaBtn').addEventListener('click', function() {
            if (!confirm('–ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Dzyga —Å–µ—Ä–≤—ñ—Å? –¶–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–¥—É–ª—å –ø–æ—à—É–∫—É —á–∞—Å—Ç–æ—Ç.')) {
                return;
            }

            const btn = this;
            const statusDiv = document.getElementById('rp2040ResetStatus');
            btn.disabled = true;
            const originalText = btn.textContent;
            btn.textContent = '‚è≥ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫...';
            
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#fff3cd';
            statusDiv.style.color = '#856404';
            statusDiv.textContent = '‚è≥ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Dzyga —Å–µ—Ä–≤—ñ—Å–∞...';

            fetch('/api/restart-dzyga', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    statusDiv.style.background = '#d4edda';
                    statusDiv.style.color = '#155724';
                    statusDiv.textContent = '‚úÖ ' + data.message;
                    showAlert('‚úÖ ' + data.message, 'success');
                } else {
                    statusDiv.style.background = '#f8d7da';
                    statusDiv.style.color = '#721c24';
                    statusDiv.textContent = '‚ùå ' + data.error;
                    showAlert('‚ùå ' + data.error, 'error');
                }
                
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 10000);
            })
            .catch(err => {
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message;
                showAlert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message, 'error');
                
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 10000);
            })
            .finally(() => {
                btn.disabled = false;
                btn.textContent = originalText;
            });
        });

        // Autostart checkbox
        document.getElementById('autostartCheckbox').addEventListener('change', function() {
            const enable = this.checked;
            
            fetch('/api/stream/autostart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ enable: enable })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('‚úÖ ' + data.message, 'success');
                } else {
                    showAlert('‚ùå ' + data.error, 'error');
                    // Revert checkbox on error
                    this.checked = !enable;
                }
            })
            .catch(err => {
                showAlert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message, 'error');
                // Revert checkbox on error
                this.checked = !enable;
            });
        });

        // Auto-restart checkbox
        document.getElementById('autorestartCheckbox').addEventListener('change', function() {
            const enable = this.checked;
            const intervalGroup = document.getElementById('autorestartIntervalGroup');
            
            // Show/hide interval input
            intervalGroup.style.display = enable ? 'block' : 'none';
            
            const interval = parseInt(document.getElementById('autorestartInterval').value) || 2;
            
            fetch('/api/autorestart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ enabled: enable, interval: interval })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('‚úÖ ' + data.message, 'success');
                } else {
                    showAlert('‚ùå ' + data.error, 'error');
                    // Revert checkbox on error
                    this.checked = !enable;
                    intervalGroup.style.display = !enable ? 'block' : 'none';
                }
            })
            .catch(err => {
                showAlert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message, 'error');
                // Revert checkbox on error
                this.checked = !enable;
                intervalGroup.style.display = !enable ? 'block' : 'none';
            });
        });

        // Auto-restart interval change
        document.getElementById('autorestartInterval').addEventListener('change', function() {
            const enabled = document.getElementById('autorestartCheckbox').checked;
            if (!enabled) return;
            
            const interval = parseInt(this.value) || 2;
            
            fetch('/api/autorestart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ enabled: true, interval: interval })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('‚úÖ –ü–µ—Ä—ñ–æ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É –æ–Ω–æ–≤–ª–µ–Ω–æ: ' + interval + '–≥–æ–¥', 'success');
                } else {
                    showAlert('‚ùå ' + data.error, 'error');
                }
            })
            .catch(err => {
                showAlert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + err.message, 'error');
            });
        });

        function loadAutorestartSettings() {
            fetch('/api/autorestart')
                .then(response => response.json())
                .then(data => {
                    const checkbox = document.getElementById('autorestartCheckbox');
                    const intervalInput = document.getElementById('autorestartInterval');
                    const intervalGroup = document.getElementById('autorestartIntervalGroup');
                    
                    checkbox.checked = data.enabled || false;
                    intervalInput.value = data.interval || 2;
                    intervalGroup.style.display = data.enabled ? 'block' : 'none';
                })
                .catch(err => console.error('Failed to load auto-restart settings:', err));
        }

        function checkUpdates() {
            const channel = document.getElementById('updateChannel').value;
            
            fetch(`/api/updates/check?channel=${channel}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Update check failed:', data.error);
                        return;
                    }
                    
                    document.getElementById('currentVersion').textContent = data.current;
                    document.getElementById('currentVersionBadge').textContent = data.current;
                    
                    // Show update available banner and badge
                    const newVersionBadge = document.getElementById('newVersionBadge');
                    if (data.has_update) {
                        document.getElementById('latestVersion').textContent = data.latest;
                        document.getElementById('updateAvailable').style.display = 'block';
                        newVersionBadge.style.display = 'inline-block';
                    } else {
                        document.getElementById('updateAvailable').style.display = 'none';
                        newVersionBadge.style.display = 'none';
                    }
                    
                    // Build releases list
                    const updatesList = document.getElementById('updatesList');
                    updatesList.innerHTML = '';
                    
                    if (data.releases && data.releases.length > 0) {
                        data.releases.forEach(release => {
                            const isCurrent = release.version === `v${data.current}`;
                            const releaseDiv = document.createElement('div');
                            releaseDiv.style.cssText = 'border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; margin-bottom: 12px;';
                            
                            let badge = '';
                            if (isCurrent) {
                                badge = '<span style="background: #667eea; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; margin-left: 8px;">–ü–û–¢–û–ß–ù–ê</span>';
                            } else if (release.prerelease) {
                                badge = '<span style="background: #ffc107; color: #333; padding: 2px 8px; border-radius: 12px; font-size: 11px; margin-left: 8px;">BETA</span>';
                            }
                            
                            releaseDiv.innerHTML = `
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <div>
                                        <strong>${release.version}</strong>
                                        ${badge}
                                    </div>
                                    <div>
                                        ${isCurrent ? '' : `<button class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;" onclick="installUpdate('${release.version}')">–û–Ω–æ–≤–∏—Ç–∏</button>`}
                                    </div>
                                </div>
                                ${release.body ? `<div style="font-size: 12px; color: #666; white-space: pre-wrap;">${release.body.substring(0, 200)}${release.body.length > 200 ? '...' : ''}</div>` : ''}
                            `;
                            
                            updatesList.appendChild(releaseDiv);
                        });
                    } else {
                        updatesList.innerHTML = '<p style="color: #666;">–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å</p>';
                    }
                })
                .catch(err => {
                    console.error('Failed to check updates:', err);
                });
        }
        function installUpdate(version) {
            if (!confirm(`–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ –¥–æ –≤–µ—Ä—Å—ñ—ó ${version}?`)) {
                return;
            }
            
            const overlay = document.getElementById('updateOverlay');
            const message = document.getElementById('updateMessage');
            
            overlay.classList.add('show');
            message.textContent = '–ó–∞–ø—É—Å–∫ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è...';
            
            fetch('/api/updates/install', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ version: version })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    message.textContent = '–û–Ω–æ–≤–ª–µ–Ω–Ω—è... –ó–∞—á–µ–∫–∞–π—Ç–µ 35 —Å–µ–∫—É–Ω–¥...';
                    
                    // Simple approach: wait 35 seconds and reload
                    // This is more reliable than polling
                    setTimeout(() => {
                        message.textContent = '‚úÖ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
                        setTimeout(() => {
                            location.reload(true);
                        }, 1000);
                    }, 35000);
                } else {
                    overlay.classList.remove('show');
                    showAlert('‚ùå ' + (data.error || '–ü–æ–º–∏–ª–∫–∞'), 'error');
                }
            })
            .catch(err => {
                overlay.classList.remove('show');
                showAlert('‚ùå ' + err.message, 'error');
            });
        }
        
        
        
        function toggleUpdateSection() {
            const content = document.getElementById('updateContent');
            const icon = document.getElementById('updateToggleIcon');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }
        
        function toggleStaticOverlay() {
            const content = document.getElementById('staticOverlaySection');
            const icon = document.getElementById('staticOverlayIcon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }
        
        function toggleStaticSettings() {
            const content = document.getElementById('staticSettings');
            const icon = document.getElementById('staticSettingsIcon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }
        
        function toggleFrequencyOverlay() {
            const content = document.getElementById('frequencyOverlaySection');
            const icon = document.getElementById('frequencyOverlayIcon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }
        
        function toggleDynamicOverlay() {
            const content = document.getElementById('dynamicOverlaySection');
            const icon = document.getElementById('dynamicOverlayIcon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }
        
        function toggleFrequencySettings() {
            const content = document.getElementById('frequencySettings');
            const icon = document.getElementById('frequencySettingsIcon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }
        
        function toggleDynamicOverlaySettings() {
            const content = document.getElementById('dynamicOverlaySettings');
            const icon = document.getElementById('dynamicOverlaySettingsIcon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }
        
        function togglePowerSettings() {
            const content = document.getElementById('powerSettingsSection');
            const icon = document.getElementById('powerSettingsIcon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
                loadPowerSettings();
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }
        
        function loadPowerSettings() {
            fetch('/api/power-settings')
                .then(response => response.json())
                .then(data => {
                    const config = data.config || {};
                    const current = data.current || {};
                    
                    // Update checkboxes
                    document.getElementById('powerSaveWifi').checked = config.POWER_SAVE_WIFI === 'true';
                    document.getElementById('powerSaveBluetooth').checked = config.POWER_SAVE_BLUETOOTH === 'true';
                    
                    // Update Ethernet speed
                    const ethSpeed = config.POWER_SAVE_ETH_SPEED;
                    const ethAutoneg = config.POWER_SAVE_ETH_AUTONEG;
                    let speedValue = 'auto';
                    if (ethSpeed === '100' && ethAutoneg === 'off') {
                        speedValue = '100';
                    } else if (ethSpeed === '1000' && ethAutoneg === 'off') {
                        speedValue = '1000';
                    }
                    document.getElementById('powerSaveEthSpeed').value = speedValue;
                    
                    // Update current state display
                    document.getElementById('currentWifiState').textContent = current.wifi_blocked ? '‚úÖ –í–∏–º–∫–Ω–µ–Ω–æ' : '‚ùå –£–≤—ñ–º–∫–Ω–µ–Ω–æ';
                    document.getElementById('currentBluetoothState').textContent = current.bluetooth_blocked ? '‚úÖ –í–∏–º–∫–Ω–µ–Ω–æ' : '‚ùå –£–≤—ñ–º–∫–Ω–µ–Ω–æ';
                    
                    let ethStateText = current.eth_speed + 'Mbps';
                    if (current.eth_autoneg === 'on') {
                        ethStateText += ' (auto-negotiation)';
                    } else {
                        ethStateText += ' (fixed)';
                    }
                    document.getElementById('currentEthState').textContent = ethStateText;
                })
                .catch(err => {
                    console.error('Failed to load power settings:', err);
                    showAlert('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –µ–Ω–µ—Ä–≥–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è', 'error');
                });
        }
        
        function applyPowerSettings() {
            const wifi = document.getElementById('powerSaveWifi').checked;
            const bluetooth = document.getElementById('powerSaveBluetooth').checked;
            const ethSpeed = document.getElementById('powerSaveEthSpeed').value;
            
            let ethSpeedValue = 'auto';
            let ethAutonegValue = 'on';
            
            if (ethSpeed === '100') {
                ethSpeedValue = '100';
                ethAutonegValue = 'off';
            } else if (ethSpeed === '1000') {
                ethSpeedValue = '1000';
                ethAutonegValue = 'off';
            }
            
            const data = {
                POWER_SAVE_WIFI: wifi ? 'true' : 'false',
                POWER_SAVE_BLUETOOTH: bluetooth ? 'true' : 'false',
                POWER_SAVE_ETH_SPEED: ethSpeedValue,
                POWER_SAVE_ETH_AUTONEG: ethAutonegValue
            };
            
            document.getElementById('applyPowerBtn').disabled = true;
            
            fetch('/api/power-settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    showAlert(result.message, 'success');
                    setTimeout(() => loadPowerSettings(), 1000);
                } else {
                    showAlert(result.error || '–ü–æ–º–∏–ª–∫–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å', 'error');
                }
            })
            .catch(err => {
                console.error('Failed to apply power settings:', err);
                showAlert('–ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            })
            .finally(() => {
                document.getElementById('applyPowerBtn').disabled = false;
            });
        }
        
        // Power settings button handler
        const applyPowerBtn = document.getElementById('applyPowerBtn');
        if (applyPowerBtn) {
            applyPowerBtn.addEventListener('click', applyPowerSettings);
        }
        
        // Update channel change handler
        document.getElementById('updateChannel').addEventListener('change', checkUpdates);

        // Dynamic overlay text input handlers
        const dynamicOverlayInput = document.getElementById('dynamicOverlayText');
        const clearButton = document.getElementById('clearDynamicText');
        
        if (dynamicOverlayInput) {
            // Show/hide clear button based on input content
            const updateClearButton = () => {
                if (clearButton) {
                    clearButton.style.display = dynamicOverlayInput.value ? 'block' : 'none';
                }
            };
            
            // Mark text as unsaved when user types
            dynamicOverlayInput.addEventListener('input', function() {
                isTextSaved = (this.value === lastSavedText);
                updateClearButton();
            });
            
            // Save on Enter key
            dynamicOverlayInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveDynamicOverlayText(this.value);
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    this.value = '';
                    isTextSaved = true;
                    lastSavedText = '';
                    updateClearButton();
                    saveDynamicOverlayText('');
                }
            });
        }
        
        // Clear button handler
        if (clearButton) {
            clearButton.addEventListener('click', function() {
                dynamicOverlayInput.value = '';
                clearButton.style.display = 'none';
                isTextSaved = true;
                lastSavedText = '';
                saveDynamicOverlayText('');
                dynamicOverlayInput.focus();
            });
        }

        // Overlay enabled toggle
        const overlayEnabledSelect = document.getElementById('OVERLAY_ENABLED');
        if (overlayEnabledSelect) {
            overlayEnabledSelect.addEventListener('change', function() {
                const config = { OVERLAY_ENABLED: this.value };
                updateOverlayUI(config);
                updateCpuModeBadge(config);
            });
        }

        // Static overlay border width toggle
        const staticBorderWidthInput = document.getElementById('OVERLAY_BORDER_WIDTH');
        if (staticBorderWidthInput) {
            staticBorderWidthInput.addEventListener('change', function() {
                const borderWidth = parseInt(this.value || 0);
                const bgGroup = document.getElementById('staticBgGroup');
                const borderGroup = document.getElementById('staticBorderGroup');
                if (bgGroup && borderGroup) {
                    if (borderWidth > 0) {
                        bgGroup.style.display = 'none';
                        borderGroup.style.display = 'block';
                    } else {
                        bgGroup.style.display = 'block';
                        borderGroup.style.display = 'none';
                    }
                }
            });
        }
        
        // Frequency border width toggle
        const freqBorderWidthInput = document.getElementById('FREQUENCY_BORDER_WIDTH');
        if (freqBorderWidthInput) {
            freqBorderWidthInput.addEventListener('change', function() {
                const borderWidth = parseInt(this.value || 0);
                const bgGroup = document.getElementById('frequencyBgGroup');
                const borderGroup = document.getElementById('frequencyBorderGroup');
                if (bgGroup && borderGroup) {
                    if (borderWidth > 0) {
                        bgGroup.style.display = 'none';
                        borderGroup.style.display = 'block';
                    } else {
                        bgGroup.style.display = 'block';
                        borderGroup.style.display = 'none';
                    }
                }
            });
        }
        
        // Dynamic overlay border width toggle
        const borderWidthInput = document.getElementById('DYNAMIC_OVERLAY_BORDER_WIDTH');
        if (borderWidthInput) {
            borderWidthInput.addEventListener('change', function() {
                const borderWidth = parseInt(this.value || 0);
                const bgGroup = document.getElementById('dynamicBgGroup');
                const borderGroup = document.getElementById('dynamicBorderGroup');
                if (bgGroup && borderGroup) {
                    if (borderWidth > 0) {
                        bgGroup.style.display = 'none';
                        borderGroup.style.display = 'block';
                    } else {
                        bgGroup.style.display = 'block';
                        borderGroup.style.display = 'none';
                    }
                }
            });
        }

        loadConfig();
        updateStatus();
        loadAutorestartSettings();
        checkUpdates();
        
        // Load dynamic overlay text on page load
        setTimeout(() => {
            loadDynamicOverlayText();
        }, 500);
        
        // Poll dynamic overlay text every 3 seconds to sync with server
        // This clears the input field when frequency changes >10 MHz
        setInterval(loadDynamicOverlayText, 3000);
        
        setInterval(updateStatus, 10000);
        setInterval(checkUpdates, 300000); // Check updates every 5 minutes
    </script>
</body>
</html>
